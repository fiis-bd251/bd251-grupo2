# 7.1. CreaciÃ³n de Tablas

```sql

DROP TABLE IF EXISTS Personas CASCADE;
DROP TABLE IF EXISTS Telefonos_persona CASCADE;
DROP TABLE IF EXISTS Correos_persona CASCADE;
DROP TABLE IF EXISTS Ubigeos CASCADE;
DROP TABLE IF EXISTS Empresas CASCADE;
DROP TABLE IF EXISTS Telefonos_empresa CASCADE;
DROP TABLE IF EXISTS Tipo_Unidad CASCADE;
DROP TABLE IF EXISTS Vehiculos CASCADE;
DROP TABLE IF EXISTS Empresas_transporte CASCADE;
DROP TABLE IF EXISTS Transportistas CASCADE;
DROP TABLE IF EXISTS Guias_remision CASCADE;
DROP TABLE IF EXISTS Programaciones_despacho CASCADE;
DROP TABLE IF EXISTS Registros_entrega CASCADE;
DROP TABLE IF EXISTS Ordenes_carga CASCADE;
DROP TABLE IF EXISTS Pedidos_despacho CASCADE;
DROP TABLE IF EXISTS Tipos_Incidencia CASCADE;
DROP TABLE IF EXISTS Detalles_entrega CASCADE;

DROP TABLE IF EXISTS Empleados CASCADE;
DROP TABLE IF EXISTS Pedidos_cliente CASCADE;
DROP TABLE IF EXISTS Lotes_producto CASCADE;

DROP TABLE IF EXISTS Envasado CASCADE;
DROP TABLE IF EXISTS Secado CASCADE;
DROP TABLE IF EXISTS Moldeado CASCADE;
DROP TABLE IF EXISTS Mezclado CASCADE;
DROP TABLE IF EXISTS Proceso_Recurrente CASCADE;
DROP TABLE IF EXISTS DosificadoxLote_insumo CASCADE;
DROP TABLE IF EXISTS Dosificado CASCADE;

DROP TABLE IF EXISTS Personas CASCADE;
DROP TABLE IF EXISTS Lote_Producto CASCADE;
DROP TABLE IF EXISTS Lote_Insumo CASCADE;
DROP TABLE IF EXISTS Ejemplar_Maquina CASCADE;

-- ENUMs
DO $$ BEGIN
    DROP TYPE IF EXISTS estado_proc_produc_enum CASCADE;
END $$;
CREATE TYPE estado_proc_produc_enum AS ENUM ('C', 'P', 'I', 'R');

DO $$ BEGIN
    DROP TYPE IF EXISTS tipo_boquilla_enum CASCADE;
END $$;
CREATE TYPE tipo_boquilla_enum AS ENUM ('MLD01', 'MLD02', 'MLD03', 'MLD04', 'MLD05');

DO $$ BEGIN
    DROP TYPE IF EXISTS tipo_envase_enum CASCADE;
END $$;
CREATE TYPE tipo_envase_enum AS ENUM ('A', 'C');


-- ENUMs
DO $$ BEGIN
    DROP TYPE IF EXISTS estado_vehiculo_enum;
END $$;
CREATE TYPE estado_vehiculo_enum AS ENUM ('A', 'I');

DO $$ BEGIN
    DROP TYPE IF EXISTS tipo_cobertura_enum;
END $$;
CREATE TYPE tipo_cobertura_enum AS ENUM ('R', 'I', 'N');

DO $$ BEGIN
    DROP TYPE IF EXISTS tipo_servicio_enum;
END $$;
CREATE TYPE tipo_servicio_enum AS ENUM ('P', 'T');

DO $$ BEGIN
    DROP TYPE IF EXISTS motivo_traslado_enum;
END $$;
CREATE TYPE motivo_traslado_enum AS ENUM ('V', 'D');

DO $$ BEGIN
    DROP TYPE IF EXISTS estado_entrega_enum;
END $$;
CREATE TYPE estado_entrega_enum AS ENUM ('P', 'C', 'R');

DO $$ BEGIN
    DROP TYPE IF EXISTS estado_orden_carga_enum;
END $$;
CREATE TYPE estado_orden_carga_enum AS ENUM ('SP', 'PL', 'TR', 'IN', 'FN');

DO $$ BEGIN
    DROP TYPE IF EXISTS motivo_despacho_enum;
END $$;
CREATE TYPE motivo_despacho_enum AS ENUM ('E', 'R');



CREATE TABLE Empleados (
    ID_EMPLEADO SERIAL PRIMARY KEY
);

CREATE TABLE Pedidos_cliente (
    ID_PEDIDO_CLIENTE SERIAL PRIMARY KEY
);

CREATE TABLE Lotes_producto (
    ID_LOTE_PRODUCTO SERIAL PRIMARY KEY
);


-- Tablas generales

CREATE TABLE Personas (
    ID_PERSONA SERIAL PRIMARY KEY,
    DNI CHAR(8) NOT NULL UNIQUE,
    NOMBRE VARCHAR(50) NOT NULL,
    AP_PATERNO VARCHAR(50) NOT NULL,
    AP_MATERNO VARCHAR(50) NOT NULL,
    DIRECCION VARCHAR(100),
    FECHA_NAC DATE
);

CREATE TABLE Telefonos_persona (
    ID_PERSONA INT NOT NULL,
    TELEFONO VARCHAR(9) NOT NULL,
    PRIMARY KEY (ID_PERSONA, TELEFONO),
    FOREIGN KEY (ID_PERSONA) REFERENCES Personas(ID_PERSONA)
);

CREATE TABLE Correos_persona (
    ID_PERSONA INT NOT NULL,
    CORREO VARCHAR(60) NOT NULL,
    PRIMARY KEY (ID_PERSONA, CORREO),
    FOREIGN KEY (ID_PERSONA) REFERENCES Personas(ID_PERSONA)
);

CREATE TABLE Ubigeos (
    ID_UBIGEO CHAR(6) PRIMARY KEY,
    DEPARTAMENTO VARCHAR(50) NOT NULL,
    PROVINCIA VARCHAR(50) NOT NULL,
    DISTRITO VARCHAR(50) NOT NULL
);

CREATE TABLE Empresas (
    ID_EMPRESA SERIAL PRIMARY KEY,
    CODIGO_RUC VARCHAR(11) NOT NULL UNIQUE,
    RAZON_SOCIAL VARCHAR(80) NOT NULL,
    NOMBRE_COMERCIAL VARCHAR(80),
    DIRECCION VARCHAR(150),
    UBIGEO_DIRECCION CHAR(6),
    FOREIGN KEY (UBIGEO_DIRECCION) REFERENCES Ubigeos(ID_UBIGEO)
);

CREATE TABLE Telefonos_empresa (
    ID_EMPRESA INT NOT NULL,
    TELEFONO VARCHAR(9) NOT NULL,
    PRIMARY KEY (ID_EMPRESA, TELEFONO),
    FOREIGN KEY (ID_EMPRESA) REFERENCES Empresas(ID_EMPRESA)
);

-- Modulo de Distribucion

CREATE TABLE Tipo_Unidad (
    CODIGO CHAR(4) PRIMARY KEY,
    DESCRIPCION VARCHAR(20) NOT NULL
);

CREATE TABLE Tipos_Incidencia (
    CODIGO CHAR(2) PRIMARY KEY,
    DESCRIPCION VARCHAR(50) NOT NULL
);

CREATE TABLE Vehiculos (
    ID_VEHICULO SERIAL PRIMARY KEY,
    NUM_PLACA CHAR(10) NOT NULL UNIQUE,
    TIPO_UNIDAD CHAR(4) NOT NULL,
    ESTADO estado_vehiculo_enum NOT NULL,
    CAPAC_PESO NUMERIC(3) CHECK (CAPAC_PESO > 0),
    CAPAC_EMP NUMERIC(3) CHECK (CAPAC_EMP > 0),
    FOREIGN KEY (TIPO_UNIDAD) REFERENCES Tipo_Unidad(CODIGO)
);

CREATE TABLE Empresas_transporte (
    ID_EMPRESA INT PRIMARY KEY,
    TIPO_COBERTURA tipo_cobertura_enum NOT NULL,
    DESCRIPCION VARCHAR(50),
    FOREIGN KEY (ID_EMPRESA) REFERENCES Empresas(ID_EMPRESA)
);

CREATE TABLE Transportistas (
    ID_PERSONA INT PRIMARY KEY,
    ID_EMPRESA INT NOT NULL,
    NUM_LICENCIA CHAR(9) NOT NULL UNIQUE,
    TIPO_SERVICIO tipo_servicio_enum NOT NULL,
    FOREIGN KEY (ID_PERSONA) REFERENCES Personas(ID_PERSONA),
    FOREIGN KEY (ID_EMPRESA) REFERENCES Empresas(ID_EMPRESA)
);

CREATE TABLE Programaciones_despacho (
    ID_PROG_DESP SERIAL PRIMARY KEY,
    ID_TRANSPORTISTA INT NOT NULL,
    ID_VEHICULO INT NOT NULL,
    ID_EMPLEADO INT NOT NULL,
    CODIGO CHAR(10) NOT NULL UNIQUE,
    FECHA_PROG_SALIDA DATE NOT NULL,
    HORA_PROG_SALIDA TIME NOT NULL,
    FECHA_PROGRAMACION DATE NOT NULL,
    FOREIGN KEY (ID_TRANSPORTISTA) REFERENCES Transportistas(ID_PERSONA),
    FOREIGN KEY (ID_VEHICULO) REFERENCES Vehiculos(ID_VEHICULO),
    FOREIGN KEY (ID_EMPLEADO) REFERENCES Empleados(ID_EMPLEADO)
);

CREATE TABLE Ordenes_carga (
    ID_ORDEN_CARGA SERIAL PRIMARY KEY,
    ID_PROG_DESP INT NOT NULL,
    CODIGO VARCHAR(10) NOT NULL UNIQUE,
    FECHA_SALIDA DATE NOT NULL,
    HORA_SALIDA TIME NOT NULL,
    ESTADO estado_orden_carga_enum NOT NULL,

    FOREIGN KEY (ID_PROG_DESP) REFERENCES Programaciones_despacho(ID_PROG_DESP)
);

CREATE TABLE Pedidos_despacho (
    ID_PROG_DESP INT NOT NULL,
    ID_PEDIDO_CLIENTE INT NOT NULL,
    MOTIVO_DESPACHO motivo_despacho_enum NOT NULL,

    PRIMARY KEY (ID_PROG_DESP, ID_PEDIDO_CLIENTE),
    
    FOREIGN KEY (ID_PROG_DESP) REFERENCES Programaciones_despacho(ID_PROG_DESP),
    FOREIGN KEY (ID_PEDIDO_CLIENTE) REFERENCES Pedidos_cliente(ID_PEDIDO_CLIENTE)
);

CREATE TABLE Registros_entrega (
    ID_REG_ENT SERIAL PRIMARY KEY,
    ID_ORDEN_CARGA INT NOT NULL,
    ID_PEDIDO_CLIENTE INT NOT NULL,
    ESTADO_ENTREGA estado_entrega_enum NOT NULL,
    FECHA_ENTREGA DATE,
    HORA_ENTREGA TIME,

    FOREIGN KEY (ID_ORDEN_CARGA) REFERENCES Ordenes_carga(ID_ORDEN_CARGA),
    FOREIGN KEY (ID_PEDIDO_CLIENTE) REFERENCES Pedidos_cliente(ID_PEDIDO_CLIENTE)
);

CREATE TABLE Guias_remision (
    ID_GUIA_REM SERIAL PRIMARY KEY,
    ID_REG_ENT INT NOT NULL,
    NUM_GUIA CHAR(13) NOT NULL UNIQUE,
    MOTIVO_TRASLADO motivo_traslado_enum NOT NULL,
    FECHA_EMISION DATE NOT NULL,
    ORIGEN_DIRECCION VARCHAR(150) NOT NULL,
    UBIGEO_ORIGEN CHAR(6) NOT NULL,
    DESTINO_DIRECCION VARCHAR(150) NOT NULL,
    UBIGEO_DESTINO CHAR(6) NOT NULL,
    FOREIGN KEY (ID_REG_ENT) REFERENCES Registros_entrega(ID_REG_ENT),
    FOREIGN KEY (UBIGEO_ORIGEN) REFERENCES Ubigeos(ID_UBIGEO),
    FOREIGN KEY (UBIGEO_DESTINO) REFERENCES Ubigeos(ID_UBIGEO)
);

CREATE TABLE Detalles_entrega (
    ID_REG_ENT INT NOT NULL,
    ID_LOTE_PRODUCTO INT NOT NULL,
    CANT_ENTREGADA NUMERIC(3) CHECK (CANT_ENTREGADA >= 0),
    CANT_OBSERVADA NUMERIC(3) CHECK (CANT_OBSERVADA >= 0),
    TIPO_INCIDENCIA CHAR(2),

    PRIMARY KEY (ID_REG_ENT, ID_LOTE_PRODUCTO),

    FOREIGN KEY (ID_REG_ENT) REFERENCES Registros_entrega(ID_REG_ENT),
    FOREIGN KEY (ID_LOTE_PRODUCTO) REFERENCES Lotes_producto(ID_LOTE_PRODUCTO),
    FOREIGN KEY (TIPO_INCIDENCIA) REFERENCES Tipos_Incidencia(CODIGO)
);




CREATE TABLE Personas (
    ID_PERSONA SERIAL PRIMARY KEY,
    NOMBRE VARCHAR(50) NOT NULL
);

CREATE TABLE Lote_Producto (
    ID_LOTE_PRODUCTO SERIAL PRIMARY KEY
);

CREATE TABLE Lote_Insumo (
    ID_LOTE_INSUMO SERIAL PRIMARY KEY
);

CREATE TABLE Ejemplar_Maquina (
    ID_EJEMPLAR_MAQUINA SERIAL PRIMARY KEY
);

CREATE TABLE Dosificado (
    ID_DOSIFICADO SERIAL PRIMARY KEY,
    COD_DOSIFICADO VARCHAR(8) UNIQUE NOT NULL,
    NUMERO_BATCH NUMERIC(2) CHECK (NUMERO_BATCH > 0),
    FECHA_PROCESO DATE NOT NULL,
    HORA_INICIO TIME NOT NULL,
    TIEMPO_PROCESO NUMERIC(3) CHECK (TIEMPO_PROCESO > 0),
    ESTADO estado_proc_produc_enum,
    ID_LOTE_PRODUCTO INT,
    ID_EMPLEADO INT,
    foreign key (Id_lote_producto) REFERENCES Lote_Producto(ID_LOTE_PRODUCTO),
    Foreign key (Id_EMPLEADO)REFERENCES Personas(ID_PERSONA)
);

CREATE TABLE DosificadoxLote_insumo (
    ID_DOSIFICADO INT REFERENCES Dosificado(ID_DOSIFICADO),
    ID_LOTE_INSUMO INT REFERENCES Lote_Insumo(ID_LOTE_INSUMO),
    CANTIDAD_DOSIFICADA NUMERIC(2,1) CHECK (CANTIDAD_DOSIFICADA > 0),
    PRIMARY KEY (ID_DOSIFICADO, ID_LOTE_INSUMO)
);

CREATE TABLE Proceso_Recurrente (
    ID_PROCESO_RECURRENTE SERIAL PRIMARY KEY,
    NUMERO_BATCH NUMERIC(2) CHECK (NUMERO_BATCH > 0),
    FECHA_PROCESO DATE NOT NULL,
    HORA_INICIO TIME NOT NULL,
    TIEMPO_PROCESO NUMERIC(3) CHECK (TIEMPO_PROCESO > 0),
    PESO_INICIAL NUMERIC(5,1) CHECK (PESO_INICIAL > 0),
    MERMA NUMERIC(5,1) CHECK (MERMA >= 0),
    ESTADO estado_proc_produc_enum,
    ID_LOTE_PRODUCTO INT UNIQUE REFERENCES Lote_Producto(ID_LOTE_PRODUCTO)
);

CREATE TABLE Mezclado (
    ID_PROCESO_RECURRENTE INT PRIMARY KEY REFERENCES Proceso_Recurrente(ID_PROCESO_RECURRENTE),
    COD_MEZCLADO VARCHAR(8) UNIQUE NOT NULL,
    PORCENTAJE_HUMEDAD NUMERIC(2,2) CHECK (PORCENTAJE_HUMEDAD > 0),
    CANTIDAD_AGUA NUMERIC(3) CHECK (CANTIDAD_AGUA > 0),
    ID_EMPLEADO INT UNIQUE REFERENCES Personas(ID_PERSONA),
    ID_EJEMPLAR_MAQUINA INT UNIQUE REFERENCES Ejemplar_Maquina(ID_EJEMPLAR_MAQUINA),
    ID_FORMULACION INT UNIQUE
);

CREATE TABLE Moldeado (
    ID_PROCESO_RECURRENTE INT PRIMARY KEY REFERENCES Proceso_Recurrente(ID_PROCESO_RECURRENTE),
    COD_MOLDEADO VARCHAR(8) UNIQUE NOT NULL,
    TIPO_BOQUILLA tipo_boquilla_enum,
    PRESION NUMERIC(6,2) CHECK (PRESION > 0),
    VELOCIDAD_CORTE NUMERIC(6,2) CHECK (VELOCIDAD_CORTE > 0),
    TAMANO_CORTE NUMERIC(6,2) CHECK (TAMANO_CORTE > 0),
    ID_EMPLEADO INT unique REFERENCES Personas(ID_PERSONA),
    ID_EJEMPLAR_MAQUINA INT unique REFERENCES Ejemplar_Maquina(ID_EJEMPLAR_MAQUINA)
);

CREATE TABLE Secado (
    ID_PROCESO_RECURRENTE INT PRIMARY KEY REFERENCES Proceso_Recurrente(ID_PROCESO_RECURRENTE),
    COD_SECADO VARCHAR(8) UNIQUE NOT NULL,
    NUMERO_BANDEJAS NUMERIC(2) CHECK (NUMERO_BANDEJAS > 0),
    TEMPERATURA_INICIAL NUMERIC(7,3) CHECK (TEMPERATURA_INICIAL > 0),
    TEMPERATURA_FINAL NUMERIC(7,3) CHECK (TEMPERATURA_FINAL > 0),
    PORCENTAJE_HUMEDAD numeric(4,2) CHECK (PORCENTAJE_HUMEDAD > 0),
    ID_EMPLEADO INT UNIQUE REFERENCES Personas(ID_PERSONA),
    ID_EJEMPLAR_MAQUINA INT unique REFERENCES Ejemplar_Maquina(ID_EJEMPLAR_MAQUINA)
);

CREATE TABLE Envasado (
    ID_ENVASADO SERIAL PRIMARY KEY,
    COD_ENVASADO VARCHAR(8) UNIQUE NOT NULL,
    FECHA_PROCESO DATE NOT NULL,
    NUMERO_BATCH NUMERIC(2) CHECK (NUMERO_BATCH > 0),
    TIPO_ENVASE tipo_envase_enum,
    HORA_INICIO TIME NOT NULL,
    TIEMPO_PROCESO NUMERIC(3) CHECK (TIEMPO_PROCESO > 0),
    PESO NUMERIC(4) CHECK (PESO > 0),
    ESTADO estado_proc_produc_enum,
    ID_LOTE_PRODUCTO INT UNIQUE  REFERENCES Lote_Producto(ID_LOTE_PRODUCTO),
    ID_EMPLEADO INT UNIQUE  REFERENCES Personas(ID_PERSONA)
);



```