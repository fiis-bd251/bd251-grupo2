# 7.1. CreaciÃ³n de Tablas

```sql

DROP TABLE IF EXISTS Personas CASCADE;
DROP TABLE IF EXISTS Telefonos_persona CASCADE;
DROP TABLE IF EXISTS Correos_persona CASCADE;
DROP TABLE IF EXISTS Ubigeos CASCADE;
DROP TABLE IF EXISTS Empresas CASCADE;
DROP TABLE IF EXISTS Telefonos_empresa CASCADE;
DROP TABLE IF EXISTS Tipo_Unidad CASCADE;
DROP TABLE IF EXISTS Vehiculos CASCADE;
DROP TABLE IF EXISTS Empresas_transporte CASCADE;
DROP TABLE IF EXISTS Transportistas CASCADE;
DROP TABLE IF EXISTS Guias_remision CASCADE;
DROP TABLE IF EXISTS Programaciones_despacho CASCADE;
DROP TABLE IF EXISTS Registros_entrega CASCADE;
DROP TABLE IF EXISTS Ordenes_carga CASCADE;
DROP TABLE IF EXISTS Pedidos_despacho CASCADE;
DROP TABLE IF EXISTS Tipos_Incidencia CASCADE;
DROP TABLE IF EXISTS Detalles_entrega CASCADE;

DROP TABLE IF EXISTS Inspeccion_Lote_Insumo CASCADE;
DROP TABLE IF EXISTS Inspeccion_Proceso CASCADE;
DROP TABLE IF EXISTS Inspeccion_Envasado CASCADE;
DROP TABLE IF EXISTS Inspeccion_Picking CASCADE;
DROP TABLE IF EXISTS Inspeccion_General CASCADE;

DROP TABLE IF EXISTS Empleados CASCADE;
DROP TABLE IF EXISTS Pedidos_cliente CASCADE;
DROP TABLE IF EXISTS Lotes_producto CASCADE;

DROP TABLE IF EXISTS Envasado CASCADE;
DROP TABLE IF EXISTS Secado CASCADE;
DROP TABLE IF EXISTS Moldeado CASCADE;
DROP TABLE IF EXISTS Mezclado CASCADE;
DROP TABLE IF EXISTS Proceso_Recurrente CASCADE;
DROP TABLE IF EXISTS DosificadoxLote_insumo CASCADE;
DROP TABLE IF EXISTS Dosificado CASCADE;

DROP TABLE IF EXISTS Personas CASCADE;
DROP TABLE IF EXISTS Lote_Producto CASCADE;
DROP TABLE IF EXISTS Lote_Insumo CASCADE;
DROP TABLE IF EXISTS Ejemplar_Maquina CASCADE;

DROP TABLE IF EXISTS lote_producto CASCADE;
DROP TABLE IF EXISTS orden_produccion CASCADE;
DROP TABLE IF EXISTS solicitud_produccion CASCADE;

DROP TABLE IF EXISTS orden_de_Mantenimiento CASCADE;
DROP TABLE IF EXISTS solicitud_de_Mantenimiento CASCADE;
DROP TABLE IF EXISTS ejemplar_de_Maquina CASCADE;
DROP TABLE IF EXISTS tipo_de_Maquina CASCADE;
DROP TABLE IF EXISTS empleados CASCADE;
DROP TABLE IF EXISTS producto CASCADE;
DROP TABLE IF EXISTS inspeccion_proceso CASCADE;
DROP TABLE IF EXISTS solicitud_produccion CASCADE;
DROP TABLE IF EXISTS despacho CASCADE;
DROP TABLE IF EXISTS recepcion CASCADE;
DROP TABLE IF EXISTS stock CASCADE;
DROP TABLE IF EXISTS detalle_movimiento CASCADE;
DROP TABLE IF EXISTS movimiento CASCADE;
DROP TABLE IF EXISTS picking CASCADE;
DROP TABLE IF EXISTS detalle_pedido CASCADE;
DROP TABLE IF EXISTS pedido_cliente CASCADE;
DROP TABLE IF EXISTS zona_entrega CASCADE;
DROP TABLE IF EXISTS ubicacion CASCADE;
DROP TABLE IF EXISTS lote_producto CASCADE;
DROP TABLE IF EXISTS producto CASCADE;
DROP TABLE IF EXISTS empleado CASCADE;

DROP TABLE IF EXISTS solicitud_produccion CASCADE;
DROP TABLE IF EXISTS despacho CASCADE;
DROP TABLE IF EXISTS recepcion CASCADE;
DROP TABLE IF EXISTS stock CASCADE;
DROP TABLE IF EXISTS detalle_movimiento CASCADE;
DROP TABLE IF EXISTS movimiento CASCADE;
DROP TABLE IF EXISTS picking CASCADE;
DROP TABLE IF EXISTS detalle_pedido CASCADE;
DROP TABLE IF EXISTS pedido_cliente CASCADE;
DROP TABLE IF EXISTS zona_entrega CASCADE;
DROP TABLE IF EXISTS ubicacion CASCADE;
DROP TABLE IF EXISTS lote_producto CASCADE;
DROP TABLE IF EXISTS producto CASCADE;
DROP TABLE IF EXISTS empleado CASCADE;

-- ENUMs
DO $$ BEGIN
    DROP TYPE IF EXISTS estado_proc_produc_enum CASCADE;
END $$;
CREATE TYPE estado_proc_produc_enum AS ENUM ('C', 'P', 'I', 'R');

DO $$ BEGIN
    DROP TYPE IF EXISTS tipo_boquilla_enum CASCADE;
END $$;
CREATE TYPE tipo_boquilla_enum AS ENUM ('MLD01', 'MLD02', 'MLD03', 'MLD04', 'MLD05');

DO $$ BEGIN
    DROP TYPE IF EXISTS tipo_envase_enum CASCADE;
END $$;
CREATE TYPE tipo_envase_enum AS ENUM ('A', 'C');

DO $$ BEGIN
    DROP TYPE IF EXISTS tipo_inspeccion_enum;
END $$;
CREATE TYPE tipo_inspeccion_enum AS ENUM ('LOT', 'PRO', 'ENV', 'PIC');

DO $$ BEGIN
    DROP TYPE IF EXISTS estado_enum;
END $$;
CREATE TYPE estado_enum AS ENUM ('PND', 'REV');

DO $$ BEGIN
    DROP TYPE IF EXISTS tipo_fallo_enum;
END $$;
CREATE TYPE tipo_fallo_enum AS ENUM ('HUM', 'MAQ');

DO $$ BEGIN
    DROP TYPE IF EXISTS tipo_defecto_empaque_enum;
END $$;
CREATE TYPE tipo_defecto_empaque_enum AS ENUM ('ETM', 'EMP', 'MAN', 'ROT');

DO $$ BEGIN
    DROP TYPE IF EXISTS motivo_defecto_picking_enum;
END $$;
CREATE TYPE motivo_defecto_picking_enum AS ENUM ('CJR', 'SEL', 'COD', 'HUM', 'ETI', 'GOL');

DO $$ BEGIN
    DROP TYPE IF EXISTS motivo_rechazo_insumo_enum;
END $$;
CREATE TYPE motivo_rechazo_insumo_enum AS ENUM ('SCR', 'HUM', 'FVC', 'CTN', 'ETI', 'CON');


-- ENUMs
DO $$ BEGIN
    DROP TYPE IF EXISTS estado_vehiculo_enum;
END $$;
CREATE TYPE estado_vehiculo_enum AS ENUM ('A', 'I');

DO $$ BEGIN
    DROP TYPE IF EXISTS tipo_cobertura_enum;
END $$;
CREATE TYPE tipo_cobertura_enum AS ENUM ('R', 'I', 'N');

DO $$ BEGIN
    DROP TYPE IF EXISTS tipo_servicio_enum;
END $$;
CREATE TYPE tipo_servicio_enum AS ENUM ('P', 'T');

DO $$ BEGIN
    DROP TYPE IF EXISTS motivo_traslado_enum;
END $$;
CREATE TYPE motivo_traslado_enum AS ENUM ('V', 'D');

DO $$ BEGIN
    DROP TYPE IF EXISTS estado_entrega_enum;
END $$;
CREATE TYPE estado_entrega_enum AS ENUM ('P', 'C', 'R');

DO $$ BEGIN
    DROP TYPE IF EXISTS estado_orden_carga_enum;
END $$;
CREATE TYPE estado_orden_carga_enum AS ENUM ('SP', 'PL', 'TR', 'IN', 'FN');

DO $$ BEGIN
    DROP TYPE IF EXISTS motivo_despacho_enum;
END $$;
CREATE TYPE motivo_despacho_enum AS ENUM ('E', 'R');

DO $$ BEGIN
    DROP TYPE IF EXISTS estado_ejemplar_enum CASCADE;
END $$;
CREATE TYPE estado_ejemplar_enum AS ENUM ('operativo', 'en mantenimiento', 'fuera de servicio');

DO $$ BEGIN
    DROP TYPE IF EXISTS estado_mantenimiento_enum CASCADE;
END $$;
CREATE TYPE estado_mantenimiento_enum AS ENUM ('con retraso', 'pendiente', 'atendida');

DO $$ BEGIN
    DROP TYPE IF EXISTS tipo_mantenimiento_enum CASCADE;
END $$;
CREATE TYPE tipo_mantenimiento_enum AS ENUM ('preventivo', 'correctivo');

DO $$ BEGIN
    DROP TYPE IF EXISTS etapa_enum CASCADE;
END $$;
CREATE TYPE etapa_enum AS ENUM ('dosificado', 'mezclado', 'moldeado', 'secado', 'almacen','envasado');

DO $$ BEGIN
    DROP TYPE IF EXISTS estado_enum CASCADE;
END $$;
CREATE TYPE estado_enum AS ENUM ('en proceso', 'completado', 'con retraso');

DO $$ BEGIN
    DROP TYPE IF EXISTS estado_lote_enum CASCADE;
END $$;
CREATE TYPE estado_lote_enum AS ENUM ('en proceso', 'completado', 'en inspeccion', 'retirado');

DO $$ BEGIN
    DROP TYPE IF EXISTS estado_solicitud_enum CASCADE;
END $$;
CREATE TYPE estado_solicitud_enum AS ENUM ('Atendida', 'Con retraso', 'Pendiente');



CREATE TABLE Empleados (
    ID_EMPLEADO SERIAL PRIMARY KEY
);

CREATE TABLE Pedidos_cliente (
    ID_PEDIDO_CLIENTE SERIAL PRIMARY KEY
);

CREATE TABLE Lotes_producto (
    ID_LOTE_PRODUCTO SERIAL PRIMARY KEY
);

CREATE TABLE empleados (
    id SERIAL primary KEY
);

CREATE TABLE producto (
    id SERIAL PRIMARY KEY
);




-- Tablas generales

CREATE TABLE Personas (
    ID_PERSONA SERIAL PRIMARY KEY,
    DNI CHAR(8) NOT NULL UNIQUE,
    NOMBRE VARCHAR(50) NOT NULL,
    AP_PATERNO VARCHAR(50) NOT NULL,
    AP_MATERNO VARCHAR(50) NOT NULL,
    DIRECCION VARCHAR(100),
    FECHA_NAC DATE
);

CREATE TABLE Telefonos_persona (
    ID_PERSONA INT NOT NULL,
    TELEFONO VARCHAR(9) NOT NULL,
    PRIMARY KEY (ID_PERSONA, TELEFONO),
    FOREIGN KEY (ID_PERSONA) REFERENCES Personas(ID_PERSONA)
);

CREATE TABLE Correos_persona (
    ID_PERSONA INT NOT NULL,
    CORREO VARCHAR(60) NOT NULL,
    PRIMARY KEY (ID_PERSONA, CORREO),
    FOREIGN KEY (ID_PERSONA) REFERENCES Personas(ID_PERSONA)
);

CREATE TABLE Ubigeos (
    ID_UBIGEO CHAR(6) PRIMARY KEY,
    DEPARTAMENTO VARCHAR(50) NOT NULL,
    PROVINCIA VARCHAR(50) NOT NULL,
    DISTRITO VARCHAR(50) NOT NULL
);

CREATE TABLE Empresas (
    ID_EMPRESA SERIAL PRIMARY KEY,
    CODIGO_RUC VARCHAR(11) NOT NULL UNIQUE,
    RAZON_SOCIAL VARCHAR(80) NOT NULL,
    NOMBRE_COMERCIAL VARCHAR(80),
    DIRECCION VARCHAR(150),
    UBIGEO_DIRECCION CHAR(6),
    FOREIGN KEY (UBIGEO_DIRECCION) REFERENCES Ubigeos(ID_UBIGEO)
);

CREATE TABLE Telefonos_empresa (
    ID_EMPRESA INT NOT NULL,
    TELEFONO VARCHAR(9) NOT NULL,
    PRIMARY KEY (ID_EMPRESA, TELEFONO),
    FOREIGN KEY (ID_EMPRESA) REFERENCES Empresas(ID_EMPRESA)
);

-- Modulo de Control de Produccion

CREATE TABLE solicitud_produccion (
    id SERIAL PRIMARY KEY,
    cod_solicitud_produccion VARCHAR(50) UNIQUE NOT NULL,
    cantidad_requerida INT NOT NULL,
    fecha_requerida DATE NOT NULL,
    fecha_solicitud DATE NOT NULL,
    hora_solicitud TIME NOT NULL,
    estado estado_solicitud_enum NOT NULL,
    id_producto INT ,
    FOREIGN KEY (id_producto) REFERENCES producto(id)
);

CREATE TABLE orden_produccion (
    id SERIAL PRIMARY KEY,
    cod_orden_produccion VARCHAR(50) UNIQUE NOT NULL,
    fecha_emision DATE NOT NULL,
    hora_emision TIME NOT NULL,
    fecha_fin_estimada DATE,
    fecha_finalizacion VARCHAR(50),
    estado estado_enum NOT NULL,
    id_solicitud_produccion INT,
    id_empleado INT ,
    FOREIGN KEY (id_solicitud_produccion) REFERENCES solicitud_produccion(id),
    FOREIGN KEY (id_empleado) REFERENCES empleados(id)
);


CREATE TABLE lote_producto (
    id SERIAL PRIMARY KEY,
    cod_lote_producto VARCHAR(50) UNIQUE NOT NULL,
    cantidad_producida INT NOT NULL,
    fecha_creacion DATE NOT NULL,
    hora_creacion TIME NOT NULL,
    estado estado_lote_enum NOT NULL,
    fecha_vencimiento DATE,
    etapa_produccion etapa_enum NOT NULL,
    id_orden_produccion INT ,
    FOREIGN KEY (id_orden_produccion) REFERENCES orden_produccion(id)
);

-- Modulo de Control de Calidad

CREATE TABLE Inspeccion_General (
    ID_INSPECCION SERIAL PRIMARY KEY,
    COD_INSPECCION CHAR(8) UNIQUE NOT NULL,
    TIPO_INSPECCION tipo_inspeccion_enum NOT NULL,
    FECHA_INSPECCION DATE NOT NULL,
    HORA_INSPECCION TIME NOT NULL,
    ESTADO estado_enum NOT NULL,
    COMENTARIO VARCHAR(300),
    EVIDENCIA VARCHAR(250),
    ID_EMPLEADO INT NOT NULL REFERENCES Empleado(ID_EMPLEADO)
);

CREATE TABLE Inspeccion_Lote_Insumo (
    ID_INSPECCION INT PRIMARY KEY REFERENCES Inspeccion_General(ID_INSPECCION),
    ID_LOTE_INSUMO INT NOT NULL REFERENCES Lote_Insumo(ID_LOTE_INSUMO),
    MOTIVO_RECHAZO motivo_rechazo_insumo_enum
);

CREATE TABLE Inspeccion_Proceso (
    ID_INSPECCION INT PRIMARY KEY REFERENCES Inspeccion_General(ID_INSPECCION),
    ID_MEZCLADO INT REFERENCES Mezclado(ID_MEZCLADO),
    ID_MOLDEADO INT REFERENCES Moldeado(ID_MOLDEADO),
    ID_SECADO INT REFERENCES Secado(ID_SECADO),
    TIPO_FALLO tipo_fallo_enum,
    DETALLE_FALLO VARCHAR(100),
    CANTIDAD_PERDIDA NUMERIC(6,2)
);

CREATE TABLE Inspeccion_Envasado (
    ID_INSPECCION INT PRIMARY KEY REFERENCES Inspeccion_General(ID_INSPECCION),
    ID_ENVASADO INT NOT NULL REFERENCES Envasado(ID_ENVASADO),
    TIPO_DEFECTO_EMPAQUE tipo_defecto_empaque_enum,
    CANTIDAD_ENVASES_DEFECTUOSOS NUMERIC(4,0) CHECK (CANTIDAD_ENVASES_DEFECTUOSOS >= 0)
);

CREATE TABLE Inspeccion_Picking (
    ID_INSPECCION INT PRIMARY KEY REFERENCES Inspeccion_General(ID_INSPECCION),
    ID_PICKING INT NOT NULL REFERENCES Picking(ID_PICKING),
    CANTIDAD_DEFECTUOSA NUMERIC(5,0) CHECK (CANTIDAD_DEFECTUOSA >= 0),
    MOTIVO_DEFECTO motivo_defecto_picking_enum
);


-- Modulo de Mantenimiento

CREATE TABLE tipo_de_Maquina (
    id SERIAL PRIMARY KEY,
    cod_tipo_maquina VARCHAR(50) UNIQUE NOT NULL,
    nombre VARCHAR(100) NOT NULL,
    marca VARCHAR(100),
    modelo VARCHAR(100),
    etapa_produccion etapa_enum NOT NULL
);

CREATE TABLE ejemplar_de_Maquina (
    id SERIAL PRIMARY KEY,
    cod_ejemplar_maquina VARCHAR(50) UNIQUE NOT NULL,
    fecha_instalacion DATE,
    estado estado_ejemplar_enum NOT NULL,
    fecha_ultimo_mantenimiento DATE,
    plan_mantenimiento INT NOT NULL,
    id_tipo_maquina INT ,
 	FOREIGN KEY (id_tipo_maquina) REFERENCES tipo_de_Maquina(id)
);

CREATE TABLE solicitud_de_mantenimiento(
    id SERIAL PRIMARY KEY,
    cod_solicitud_mantenimiento VARCHAR(50) UNIQUE NOT NULL,
    fecha_solicitud DATE,
    hora_solicitud TIME,
    fecha_requerida DATE,
    tipo_mantenimiento tipo_mantenimiento_enum NOT NULL,
    estado estado_mantenimiento_enum NOT NULL,
    id_ejemplar_maquina INT ,
    id_inspeccion_proceso INT ,
	FOREIGN KEY (id_ejemplar_maquina) REFERENCES ejemplar_de_Maquina(id),
	FOREIGN KEY (id_inspeccion_proceso) REFERENCES inspeccion_proceso(id)
);

CREATE TABLE Orden_de_mantenimiento (
    id SERIAL PRIMARY KEY,
    cod_orden_mantenimiento VARCHAR(50) UNIQUE NOT NULL,
    fecha_emision DATE,
    hora_emision TIME,
    fecha_fin_estimada DATE not NULL ,
    fecha_finalizacion VARCHAR(50),
    estado estado_enum NOT NULL,
    id_empleado INT ,
    id_solicitud_mantenimiento INT ,
    FOREIGN KEY (id_solicitud_mantenimiento) REFERENCES solicitud_de_Mantenimiento(id),
    FOREIGN KEY (id_empleado) REFERENCES empleados(id)
);

-- Modulo de Distribucion

CREATE TABLE Tipo_Unidad (
    CODIGO CHAR(4) PRIMARY KEY,
    DESCRIPCION VARCHAR(20) NOT NULL
);

CREATE TABLE Tipos_Incidencia (
    CODIGO CHAR(2) PRIMARY KEY,
    DESCRIPCION VARCHAR(50) NOT NULL
);

CREATE TABLE Vehiculos (
    ID_VEHICULO SERIAL PRIMARY KEY,
    NUM_PLACA CHAR(10) NOT NULL UNIQUE,
    TIPO_UNIDAD CHAR(4) NOT NULL,
    ESTADO estado_vehiculo_enum NOT NULL,
    CAPAC_PESO NUMERIC(3) CHECK (CAPAC_PESO > 0),
    CAPAC_EMP NUMERIC(3) CHECK (CAPAC_EMP > 0),
    FOREIGN KEY (TIPO_UNIDAD) REFERENCES Tipo_Unidad(CODIGO)
);

CREATE TABLE Empresas_transporte (
    ID_EMPRESA INT PRIMARY KEY,
    TIPO_COBERTURA tipo_cobertura_enum NOT NULL,
    DESCRIPCION VARCHAR(50),
    FOREIGN KEY (ID_EMPRESA) REFERENCES Empresas(ID_EMPRESA)
);

CREATE TABLE Transportistas (
    ID_PERSONA INT PRIMARY KEY,
    ID_EMPRESA INT NOT NULL,
    NUM_LICENCIA CHAR(9) NOT NULL UNIQUE,
    TIPO_SERVICIO tipo_servicio_enum NOT NULL,
    FOREIGN KEY (ID_PERSONA) REFERENCES Personas(ID_PERSONA),
    FOREIGN KEY (ID_EMPRESA) REFERENCES Empresas(ID_EMPRESA)
);

CREATE TABLE Programaciones_despacho (
    ID_PROG_DESP SERIAL PRIMARY KEY,
    ID_TRANSPORTISTA INT NOT NULL,
    ID_VEHICULO INT NOT NULL,
    ID_EMPLEADO INT NOT NULL,
    CODIGO CHAR(10) NOT NULL UNIQUE,
    FECHA_PROG_SALIDA DATE NOT NULL,
    HORA_PROG_SALIDA TIME NOT NULL,
    FECHA_PROGRAMACION DATE NOT NULL,
    FOREIGN KEY (ID_TRANSPORTISTA) REFERENCES Transportistas(ID_PERSONA),
    FOREIGN KEY (ID_VEHICULO) REFERENCES Vehiculos(ID_VEHICULO),
    FOREIGN KEY (ID_EMPLEADO) REFERENCES Empleados(ID_EMPLEADO)
);

CREATE TABLE Ordenes_carga (
    ID_ORDEN_CARGA SERIAL PRIMARY KEY,
    ID_PROG_DESP INT NOT NULL,
    CODIGO VARCHAR(10) NOT NULL UNIQUE,
    FECHA_SALIDA DATE NOT NULL,
    HORA_SALIDA TIME NOT NULL,
    ESTADO estado_orden_carga_enum NOT NULL,

    FOREIGN KEY (ID_PROG_DESP) REFERENCES Programaciones_despacho(ID_PROG_DESP)
);

CREATE TABLE Pedidos_despacho (
    ID_PROG_DESP INT NOT NULL,
    ID_PEDIDO_CLIENTE INT NOT NULL,
    MOTIVO_DESPACHO motivo_despacho_enum NOT NULL,

    PRIMARY KEY (ID_PROG_DESP, ID_PEDIDO_CLIENTE),
    
    FOREIGN KEY (ID_PROG_DESP) REFERENCES Programaciones_despacho(ID_PROG_DESP),
    FOREIGN KEY (ID_PEDIDO_CLIENTE) REFERENCES Pedidos_cliente(ID_PEDIDO_CLIENTE)
);

CREATE TABLE Registros_entrega (
    ID_REG_ENT SERIAL PRIMARY KEY,
    ID_ORDEN_CARGA INT NOT NULL,
    ID_PEDIDO_CLIENTE INT NOT NULL,
    ESTADO_ENTREGA estado_entrega_enum NOT NULL,
    FECHA_ENTREGA DATE,
    HORA_ENTREGA TIME,

    FOREIGN KEY (ID_ORDEN_CARGA) REFERENCES Ordenes_carga(ID_ORDEN_CARGA),
    FOREIGN KEY (ID_PEDIDO_CLIENTE) REFERENCES Pedidos_cliente(ID_PEDIDO_CLIENTE)
);

CREATE TABLE Guias_remision (
    ID_GUIA_REM SERIAL PRIMARY KEY,
    ID_REG_ENT INT NOT NULL,
    NUM_GUIA CHAR(13) NOT NULL UNIQUE,
    MOTIVO_TRASLADO motivo_traslado_enum NOT NULL,
    FECHA_EMISION DATE NOT NULL,
    ORIGEN_DIRECCION VARCHAR(150) NOT NULL,
    UBIGEO_ORIGEN CHAR(6) NOT NULL,
    DESTINO_DIRECCION VARCHAR(150) NOT NULL,
    UBIGEO_DESTINO CHAR(6) NOT NULL,
    FOREIGN KEY (ID_REG_ENT) REFERENCES Registros_entrega(ID_REG_ENT),
    FOREIGN KEY (UBIGEO_ORIGEN) REFERENCES Ubigeos(ID_UBIGEO),
    FOREIGN KEY (UBIGEO_DESTINO) REFERENCES Ubigeos(ID_UBIGEO)
);

CREATE TABLE Detalles_entrega (
    ID_REG_ENT INT NOT NULL,
    ID_LOTE_PRODUCTO INT NOT NULL,
    CANT_ENTREGADA NUMERIC(3) CHECK (CANT_ENTREGADA >= 0),
    CANT_OBSERVADA NUMERIC(3) CHECK (CANT_OBSERVADA >= 0),
    TIPO_INCIDENCIA CHAR(2),

    PRIMARY KEY (ID_REG_ENT, ID_LOTE_PRODUCTO),

    FOREIGN KEY (ID_REG_ENT) REFERENCES Registros_entrega(ID_REG_ENT),
    FOREIGN KEY (ID_LOTE_PRODUCTO) REFERENCES Lotes_producto(ID_LOTE_PRODUCTO),
    FOREIGN KEY (TIPO_INCIDENCIA) REFERENCES Tipos_Incidencia(CODIGO)
);




CREATE TABLE Personas (
    ID_PERSONA SERIAL PRIMARY KEY,
    NOMBRE VARCHAR(50) NOT NULL
);

CREATE TABLE Lote_Producto (
    ID_LOTE_PRODUCTO SERIAL PRIMARY KEY
);

CREATE TABLE Lote_Insumo (
    ID_LOTE_INSUMO SERIAL PRIMARY KEY
);

CREATE TABLE Ejemplar_Maquina (
    ID_EJEMPLAR_MAQUINA SERIAL PRIMARY KEY
);

CREATE TABLE Dosificado (
    ID_DOSIFICADO SERIAL PRIMARY KEY,
    COD_DOSIFICADO VARCHAR(8) UNIQUE NOT NULL,
    NUMERO_BATCH NUMERIC(2) CHECK (NUMERO_BATCH > 0),
    FECHA_PROCESO DATE NOT NULL,
    HORA_INICIO TIME NOT NULL,
    TIEMPO_PROCESO NUMERIC(3) CHECK (TIEMPO_PROCESO > 0),
    ESTADO estado_proc_produc_enum,
    ID_LOTE_PRODUCTO INT,
    ID_EMPLEADO INT,
    foreign key (Id_lote_producto) REFERENCES Lote_Producto(ID_LOTE_PRODUCTO),
    Foreign key (Id_EMPLEADO)REFERENCES Personas(ID_PERSONA)
);

CREATE TABLE DosificadoxLote_insumo (
    ID_DOSIFICADO INT REFERENCES Dosificado(ID_DOSIFICADO),
    ID_LOTE_INSUMO INT REFERENCES Lote_Insumo(ID_LOTE_INSUMO),
    CANTIDAD_DOSIFICADA NUMERIC(2,1) CHECK (CANTIDAD_DOSIFICADA > 0),
    PRIMARY KEY (ID_DOSIFICADO, ID_LOTE_INSUMO)
);

CREATE TABLE Proceso_Recurrente (
    ID_PROCESO_RECURRENTE SERIAL PRIMARY KEY,
    NUMERO_BATCH NUMERIC(2) CHECK (NUMERO_BATCH > 0),
    FECHA_PROCESO DATE NOT NULL,
    HORA_INICIO TIME NOT NULL,
    TIEMPO_PROCESO NUMERIC(3) CHECK (TIEMPO_PROCESO > 0),
    PESO_INICIAL NUMERIC(5,1) CHECK (PESO_INICIAL > 0),
    MERMA NUMERIC(5,1) CHECK (MERMA >= 0),
    ESTADO estado_proc_produc_enum,
    ID_LOTE_PRODUCTO INT UNIQUE REFERENCES Lote_Producto(ID_LOTE_PRODUCTO)
);

CREATE TABLE Mezclado (
    ID_PROCESO_RECURRENTE INT PRIMARY KEY REFERENCES Proceso_Recurrente(ID_PROCESO_RECURRENTE),
    COD_MEZCLADO VARCHAR(8) UNIQUE NOT NULL,
    PORCENTAJE_HUMEDAD NUMERIC(2,2) CHECK (PORCENTAJE_HUMEDAD > 0),
    CANTIDAD_AGUA NUMERIC(3) CHECK (CANTIDAD_AGUA > 0),
    ID_EMPLEADO INT UNIQUE REFERENCES Personas(ID_PERSONA),
    ID_EJEMPLAR_MAQUINA INT UNIQUE REFERENCES Ejemplar_Maquina(ID_EJEMPLAR_MAQUINA),
    ID_FORMULACION INT UNIQUE
);

CREATE TABLE Moldeado (
    ID_PROCESO_RECURRENTE INT PRIMARY KEY REFERENCES Proceso_Recurrente(ID_PROCESO_RECURRENTE),
    COD_MOLDEADO VARCHAR(8) UNIQUE NOT NULL,
    TIPO_BOQUILLA tipo_boquilla_enum,
    PRESION NUMERIC(6,2) CHECK (PRESION > 0),
    VELOCIDAD_CORTE NUMERIC(6,2) CHECK (VELOCIDAD_CORTE > 0),
    TAMANO_CORTE NUMERIC(6,2) CHECK (TAMANO_CORTE > 0),
    ID_EMPLEADO INT unique REFERENCES Personas(ID_PERSONA),
    ID_EJEMPLAR_MAQUINA INT unique REFERENCES Ejemplar_Maquina(ID_EJEMPLAR_MAQUINA)
);

CREATE TABLE Secado (
    ID_PROCESO_RECURRENTE INT PRIMARY KEY REFERENCES Proceso_Recurrente(ID_PROCESO_RECURRENTE),
    COD_SECADO VARCHAR(8) UNIQUE NOT NULL,
    NUMERO_BANDEJAS NUMERIC(2) CHECK (NUMERO_BANDEJAS > 0),
    TEMPERATURA_INICIAL NUMERIC(7,3) CHECK (TEMPERATURA_INICIAL > 0),
    TEMPERATURA_FINAL NUMERIC(7,3) CHECK (TEMPERATURA_FINAL > 0),
    PORCENTAJE_HUMEDAD numeric(4,2) CHECK (PORCENTAJE_HUMEDAD > 0),
    ID_EMPLEADO INT UNIQUE REFERENCES Personas(ID_PERSONA),
    ID_EJEMPLAR_MAQUINA INT unique REFERENCES Ejemplar_Maquina(ID_EJEMPLAR_MAQUINA)
);

CREATE TABLE Envasado (
    ID_ENVASADO SERIAL PRIMARY KEY,
    COD_ENVASADO VARCHAR(8) UNIQUE NOT NULL,
    FECHA_PROCESO DATE NOT NULL,
    NUMERO_BATCH NUMERIC(2) CHECK (NUMERO_BATCH > 0),
    TIPO_ENVASE tipo_envase_enum,
    HORA_INICIO TIME NOT NULL,
    TIEMPO_PROCESO NUMERIC(3) CHECK (TIEMPO_PROCESO > 0),
    PESO NUMERIC(4) CHECK (PESO > 0),
    ESTADO estado_proc_produc_enum,
    ID_LOTE_PRODUCTO INT UNIQUE  REFERENCES Lote_Producto(ID_LOTE_PRODUCTO),
    ID_EMPLEADO INT UNIQUE  REFERENCES Personas(ID_PERSONA)
);
--modulo de almacen
-- Tabla: Empleado
CREATE TABLE empleado (
    id_empleado SERIAL PRIMARY KEY,
    estado_laboral VARCHAR(50),
    codigo VARCHAR(50) UNIQUE
);

-- Tabla: Producto
CREATE TABLE producto (
    id_producto SERIAL PRIMARY KEY,
    codigo_producto VARCHAR(50) UNIQUE NOT NULL,
    nombre_producto VARCHAR(100) NOT NULL,
    peso_producto DECIMAL(10,2),
    unidad_medida VARCHAR(20),
    fecha_vencimiento DATE,
    presentacion VARCHAR(50),
    precio_unitario DECIMAL(10,2),
    descripcion TEXT
);

-- Tabla: Lote_producto
CREATE TABLE lote_producto (
    id_lote_producto SERIAL PRIMARY KEY,
    codigo VARCHAR(50) UNIQUE NOT NULL,
    fecha_produccion DATE NOT NULL,
    cantidad_producida DECIMAL(10,2),
    estado VARCHAR(30),
    numero_batch VARCHAR(50),
    fecha_vencimiento DATE
);

-- Tabla: Movimiento
CREATE TABLE movimiento (
    id_movimiento SERIAL PRIMARY KEY,
    fecha_movimiento DATE NOT NULL,
    hora_movimiento TIME,
    id_empleado INT NOT NULL,
    FOREIGN KEY (id_empleado) REFERENCES empleado(id_empleado)
);

-- Tabla: Detalle_Movimiento
CREATE TABLE detalle_movimiento (
    id_detalle_movimiento SERIAL PRIMARY KEY,
    cantidad_movida DECIMAL(10,2),
    ubicacion_inicial VARCHAR(100),
    ubicacion_final VARCHAR(100),
    nombre_producto VARCHAR(100),
    id_lote_producto INT NOT NULL,
    id_movimiento INT NOT NULL,
    FOREIGN KEY (id_lote_producto) REFERENCES lote_producto(id_lote_producto),
    FOREIGN KEY (id_movimiento) REFERENCES movimiento(id_movimiento)
);

-- Tabla: Ubicacion
CREATE TABLE ubicacion (
    id_ubicacion SERIAL PRIMARY KEY,
    zona VARCHAR(50),
    estanteria VARCHAR(50),
    nivel VARCHAR(50),
    estado VARCHAR(30),
    id_detalle_movimiento INT,
    FOREIGN KEY (id_detalle_movimiento) REFERENCES detalle_movimiento(id_detalle_movimiento)
);

-- Tabla: Zona_entrega
CREATE TABLE zona_entrega (
    id_zona_entrega SERIAL PRIMARY KEY,
    departamento VARCHAR(100),
    provincia VARCHAR(100),
    distrito VARCHAR(100)
);

-- Tabla: Pedido_cliente
CREATE TABLE pedido_cliente (
    id_pedido SERIAL PRIMARY KEY,
    fecha_registro DATE NOT NULL,
    fecha_entrega_programada DATE,
    codigo VARCHAR(50) UNIQUE,
    id_zona_entrega INT NOT NULL,
    direccion_entrega VARCHAR(255),
    estado VARCHAR(50),
    FOREIGN KEY (id_zona_entrega) REFERENCES zona_entrega(id_zona_entrega)
);

-- Tabla: Detalle_pedido
CREATE TABLE detalle_pedido (
    id_detalle_pedido SERIAL PRIMARY KEY,
    cantidad_solicitada DECIMAL(10,2) NOT NULL,
    nombre_producto VARCHAR(100),
    detalle_pedido TEXT,
    id_producto INT NOT NULL,
    id_pedido INT NOT NULL,
    FOREIGN KEY (id_producto) REFERENCES producto(id_producto),
    FOREIGN KEY (id_pedido) REFERENCES pedido_cliente(id_pedido)
);

-- Tabla: Picking
CREATE TABLE picking (
    id_picking SERIAL PRIMARY KEY,
    fecha_picking DATE NOT NULL,
    hora_picking TIME,
    estado VARCHAR(30),
    id_pedido INT NOT NULL,
    id_detalle_pedido INT NOT NULL,
    id_empleado INT NOT NULL,
    FOREIGN KEY (id_pedido) REFERENCES pedido_cliente(id_pedido),
    FOREIGN KEY (id_detalle_pedido) REFERENCES detalle_pedido(id_detalle_pedido),
    FOREIGN KEY (id_empleado) REFERENCES empleado(id_empleado)
);

-- Tabla: Stock
CREATE TABLE stock (
    id_stock SERIAL PRIMARY KEY,
    stock_minimo DECIMAL(10,2),
    cantidad_disponible DECIMAL(10,2),
    id_producto INT NOT NULL,
    id_lote_producto INT NOT NULL,
    id_ubicacion INT NOT NULL,
    id_detalle_movimiento INT,
    FOREIGN KEY (id_producto) REFERENCES producto(id_producto),
    FOREIGN KEY (id_lote_producto) REFERENCES lote_producto(id_lote_producto),
    FOREIGN KEY (id_ubicacion) REFERENCES ubicacion(id_ubicacion),
    FOREIGN KEY (id_detalle_movimiento) REFERENCES detalle_movimiento(id_detalle_movimiento)
);

-- Tabla: Recepcion
CREATE TABLE recepcion (
    id_recepcion SERIAL PRIMARY KEY,
    fecha_recepcion DATE NOT NULL,
    hora_recepcion TIME,
    cantidad DECIMAL(10,2),
    id_lote_produccion INT NOT NULL,
    id_empleado INT NOT NULL,
    FOREIGN KEY (id_lote_produccion) REFERENCES lote_producto(id_lote_producto),
    FOREIGN KEY (id_empleado) REFERENCES empleado(id_empleado)
);

-- Tabla: Despacho
CREATE TABLE despacho (
    id_despacho SERIAL PRIMARY KEY,
    fecha_despacho DATE NOT NULL,
    hora_despacho TIME,
    estado VARCHAR(30),
    id_picking INT NOT NULL,
    id_detalle_movimiento INT NOT NULL,
    FOREIGN KEY (id_picking) REFERENCES picking(id_picking),
    FOREIGN KEY (id_detalle_movimiento) REFERENCES detalle_movimiento(id_detalle_movimiento)
);

-- Tabla: Solicitud_produccion
CREATE TABLE solicitud_produccion (
    id_solicitud_produccion SERIAL PRIMARY KEY,
    fecha_requerida DATE NOT NULL,
    cantidad_requerida DECIMAL(10, 2) NOT NULL,
    codigo VARCHAR(50) UNIQUE,
    estado VARCHAR(50),
    id_empleado INT NOT NULL,
    FOREIGN KEY (id_empleado) REFERENCES empleado(id_empleado)
);

-- Tabla: Empleado
CREATE TABLE empleado (
    id_empleado SERIAL PRIMARY KEY,
    estado_laboral VARCHAR(50),
    codigo VARCHAR(50) UNIQUE
);

-- Tabla: Producto
CREATE TABLE producto (
    id_producto SERIAL PRIMARY KEY,
    codigo_producto VARCHAR(50) UNIQUE NOT NULL,
    nombre_producto VARCHAR(100) NOT NULL,
    peso_producto DECIMAL(10,2),
    unidad_medida VARCHAR(20),
    fecha_vencimiento DATE,
    presentacion VARCHAR(50),
    precio_unitario DECIMAL(10,2),
    descripcion TEXT
);

-- Tabla: Lote_producto
CREATE TABLE lote_producto (
    id_lote_producto SERIAL PRIMARY KEY,
    codigo VARCHAR(50) UNIQUE NOT NULL,
    fecha_produccion DATE NOT NULL,
    cantidad_producida DECIMAL(10,2),
    estado VARCHAR(30),
    numero_batch VARCHAR(50),
    fecha_vencimiento DATE
);

-- Tabla: Movimiento
CREATE TABLE movimiento (
    id_movimiento SERIAL PRIMARY KEY,
    fecha_movimiento DATE NOT NULL,
    hora_movimiento TIME,
    id_empleado INT NOT NULL,
    FOREIGN KEY (id_empleado) REFERENCES empleado(id_empleado)
);

-- Tabla: Detalle_Movimiento
CREATE TABLE detalle_movimiento (
    id_detalle_movimiento SERIAL PRIMARY KEY,
    cantidad_movida DECIMAL(10,2),
    ubicacion_inicial VARCHAR(100),
    ubicacion_final VARCHAR(100),
    nombre_producto VARCHAR(100),
    id_lote_producto INT NOT NULL,
    id_movimiento INT NOT NULL,
    FOREIGN KEY (id_lote_producto) REFERENCES lote_producto(id_lote_producto),
    FOREIGN KEY (id_movimiento) REFERENCES movimiento(id_movimiento)
);

-- Tabla: Ubicacion
CREATE TABLE ubicacion (
    id_ubicacion SERIAL PRIMARY KEY,
    zona VARCHAR(50),
    estanteria VARCHAR(50),
    nivel VARCHAR(50),
    estado VARCHAR(30),
    id_detalle_movimiento INT,
    FOREIGN KEY (id_detalle_movimiento) REFERENCES detalle_movimiento(id_detalle_movimiento)
);

-- Tabla: Zona_entrega
CREATE TABLE zona_entrega (
    id_zona_entrega SERIAL PRIMARY KEY,
    departamento VARCHAR(100),
    provincia VARCHAR(100),
    distrito VARCHAR(100)
);

-- Tabla: Pedido_cliente
CREATE TABLE pedido_cliente (
    id_pedido SERIAL PRIMARY KEY,
    fecha_registro DATE NOT NULL,
    fecha_entrega_programada DATE,
    codigo VARCHAR(50) UNIQUE,
    id_zona_entrega INT NOT NULL,
    direccion_entrega VARCHAR(255),
    estado VARCHAR(50),
    FOREIGN KEY (id_zona_entrega) REFERENCES zona_entrega(id_zona_entrega)
);

-- Tabla: Detalle_pedido
CREATE TABLE detalle_pedido (
    id_detalle_pedido SERIAL PRIMARY KEY,
    cantidad_solicitada DECIMAL(10,2) NOT NULL,
    nombre_producto VARCHAR(100),
    detalle_pedido TEXT,
    id_producto INT NOT NULL,
    id_pedido INT NOT NULL,
    FOREIGN KEY (id_producto) REFERENCES producto(id_producto),
    FOREIGN KEY (id_pedido) REFERENCES pedido_cliente(id_pedido)
);

-- Tabla: Picking
CREATE TABLE picking (
    id_picking SERIAL PRIMARY KEY,
    fecha_picking DATE NOT NULL,
    hora_picking TIME,
    estado VARCHAR(30),
    id_pedido INT NOT NULL,
    id_detalle_pedido INT NOT NULL,
    id_empleado INT NOT NULL,
    FOREIGN KEY (id_pedido) REFERENCES pedido_cliente(id_pedido),
    FOREIGN KEY (id_detalle_pedido) REFERENCES detalle_pedido(id_detalle_pedido),
    FOREIGN KEY (id_empleado) REFERENCES empleado(id_empleado)
);

-- Tabla: Stock
CREATE TABLE stock (
    id_stock SERIAL PRIMARY KEY,
    stock_minimo DECIMAL(10,2),
    cantidad_disponible DECIMAL(10,2),
    id_producto INT NOT NULL,
    id_lote_producto INT NOT NULL,
    id_ubicacion INT NOT NULL,
    id_detalle_movimiento INT,
    FOREIGN KEY (id_producto) REFERENCES producto(id_producto),
    FOREIGN KEY (id_lote_producto) REFERENCES lote_producto(id_lote_producto),
    FOREIGN KEY (id_ubicacion) REFERENCES ubicacion(id_ubicacion),
    FOREIGN KEY (id_detalle_movimiento) REFERENCES detalle_movimiento(id_detalle_movimiento)
);

-- Tabla: Recepcion
CREATE TABLE recepcion (
    id_recepcion SERIAL PRIMARY KEY,
    fecha_recepcion DATE NOT NULL,
    hora_recepcion TIME,
    cantidad DECIMAL(10,2),
    id_lote_produccion INT NOT NULL,
    id_empleado INT NOT NULL,
    FOREIGN KEY (id_lote_produccion) REFERENCES lote_producto(id_lote_producto),
    FOREIGN KEY (id_empleado) REFERENCES empleado(id_empleado)
);

-- Tabla: Despacho
CREATE TABLE despacho (
    id_despacho SERIAL PRIMARY KEY,
    fecha_despacho DATE NOT NULL,
    hora_despacho TIME,
    estado VARCHAR(30),
    id_picking INT NOT NULL,
    id_detalle_movimiento INT NOT NULL,
    FOREIGN KEY (id_picking) REFERENCES picking(id_picking),
    FOREIGN KEY (id_detalle_movimiento) REFERENCES detalle_movimiento(id_detalle_movimiento)
);

-- Tabla: Solicitud_produccion
CREATE TABLE solicitud_produccion (
    id_solicitud_produccion SERIAL PRIMARY KEY,
    fecha_requerida DATE NOT NULL,
    cantidad_requerida DECIMAL(10, 2) NOT NULL,
    codigo VARCHAR(50) UNIQUE,
    estado VARCHAR(50),
    id_empleado INT NOT NULL,
    FOREIGN KEY (id_empleado) REFERENCES empleado(id_empleado)
);


```
